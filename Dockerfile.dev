# Development image: full deps, nodemon + ts-node, hot reload via volume mounts
FROM node:20-alpine

WORKDIR /app

# Copy package files
COPY package.json package-lock.json ./

# Install all dependencies (including dev: nodemon, ts-node, types)
RUN npm ci --ignore-scripts

# Copy source, Prisma, and config (prisma generate will run; overwritten by volumes in compose)
COPY . .

# Generate Prisma client (used at build; schema may be overwritten by volume)
RUN npx prisma generate

# Dev entrypoint: wait for DB, run migrations, then npm run dev (nodemon)
COPY docker-entrypoint-dev.sh ./
RUN chmod +x docker-entrypoint-dev.sh

EXPOSE 3000

ENTRYPOINT ["./docker-entrypoint-dev.sh"]
